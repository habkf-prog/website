<!doctype html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>M3U Tool</title>
  <style>
    body{font-family:system-ui,-apple-system,Segoe UI,Roboto,Arial;padding:16px;line-height:1.6}
    .card{max-width:820px;margin:0 auto;border:1px solid #ddd;border-radius:14px;padding:14px}
    h1{font-size:18px;margin:0 0 10px}
    textarea,input{width:100%;box-sizing:border-box;padding:10px;border:1px solid #ddd;border-radius:10px}
    textarea{min-height:140px}
    .row{display:flex;gap:12px;flex-wrap:wrap;margin-top:10px}
    .row>*{flex:1;min-width:240px}
    button{padding:10px 14px;border:0;border-radius:10px;cursor:pointer;font-weight:700}
    .muted{color:#555;font-size:13px}
    .log{margin-top:12px;background:#f7f7f7;border-radius:10px;padding:10px;white-space:pre-wrap}
    label{font-weight:700;display:block;margin:10px 0 6px}
    .chk{display:flex;gap:8px;align-items:center;font-weight:700;margin-top:8px}
  </style>
</head>
<body>
  <div class="card">
    <h1>ğŸ“º Ø¯Ù…Ø¬ Ù‚ÙˆØ§Ø¦Ù… M3U (Ø±ÙˆØ§Ø¨Ø· + Ù…Ù„ÙØ§Øª) ÙÙŠ Ù…Ù„Ù ÙˆØ§Ø­Ø¯</h1>
    <div class="muted">Ø¨Ø¯ÙˆÙ† ØªØ·Ø¨ÙŠÙ‚Ø§Øª Ø¥Ø¶Ø§ÙÙŠØ©ØŒ ÙŠØ¹Ù…Ù„ Ù…Ø­Ù„ÙŠÙ‹Ø§ Ø¹Ù„Ù‰ Ù‡Ø§ØªÙÙƒ.</div>

    <label>1) Ø£Ù„ØµÙ‚ Ø±ÙˆØ§Ø¨Ø· M3U (Raw) â€” Ø±Ø§Ø¨Ø· ÙÙŠ ÙƒÙ„ Ø³Ø·Ø± (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
    <textarea id="urls" placeholder="https://raw.githubusercontent.com/.../main/a.m3u
https://raw.githubusercontent.com/.../main/b.m3u"></textarea>

    <label>2) Ø£Ùˆ Ø§Ø®ØªØ± Ù…Ù„ÙØ§Øª M3U Ù…Ù† Ø¬Ù‡Ø§Ø²Ùƒ (Ø§Ø®ØªÙŠØ§Ø±ÙŠ):</label>
    <input id="files" type="file" multiple accept=".m3u,.m3u8,text/plain" />

    <div class="row">
      <label class="chk"><input id="dedup" type="checkbox" checked> Ø­Ø°Ù Ø§Ù„Ù…ÙƒØ±Ø± Ø­Ø³Ø¨ Ø±Ø§Ø¨Ø· Ø§Ù„Ø¨Ø«</label>
      <label class="chk"><input id="sort" type="checkbox"> ØªØ±ØªÙŠØ¨ Ø£Ø¨Ø¬Ø¯ÙŠ</label>
    </div>

    <div class="row">
      <div>
        <label>Ø§Ø³Ù… Ø§Ù„Ù…Ù„Ù Ø§Ù„Ù†Ø§ØªØ¬:</label>
        <input id="outname" value="merged.m3u" />
      </div>
      <div style="display:flex;align-items:end">
        <button id="go">Ø¯Ù…Ø¬ ÙˆØªÙ†Ø²ÙŠÙ„ âœ…</button>
      </div>
    </div>

    <div id="log" class="log">Ø¬Ø§Ù‡Ø².</div>
  </div>

<script>
const $ = (id)=>document.getElementById(id);
const log = (m)=>{ $("log").textContent = m; };

function parseM3U(text){
  const lines = text.split(/\r?\n/).map(l=>l.trim()).filter(Boolean);
  const out = [];
  let extinf = null;
  for(const ln of lines){
    if(ln.startsWith("#EXTM3U")) continue;
    if(ln.startsWith("#EXTINF")){ extinf = ln; continue; }
    if(ln.startsWith("#")) continue;
    if(!extinf) extinf = "#EXTINF:-1,Unknown";
    out.push({extinf, url: ln});
    extinf = null;
  }
  return out;
}
function channelName(extinf){
  const i = extinf.indexOf(",");
  return (i>=0?extinf.slice(i+1):extinf).trim().toLowerCase();
}
async function readFileText(file){
  return new Promise((res, rej)=>{
    const r = new FileReader();
    r.onload = ()=>res(r.result||"");
    r.onerror = rej;
    r.readAsText(file);
  });
}
async function fetchText(url){
  const r = await fetch(url, {headers:{'User-Agent':'m3u-tool/1.0'}});
  if(!r.ok) throw new Error("HTTP "+r.status);
  return await r.text();
}
function download(filename, text){
  const blob = new Blob([text], {type:"audio/x-mpegurl;charset=utf-8"});
  const u = URL.createObjectURL(blob);
  const a = document.createElement("a");
  a.href = u; a.download = filename || "merged.m3u";
  document.body.appendChild(a); a.click(); a.remove();
  URL.revokeObjectURL(u);
}

$("go").onclick = async ()=>{
  const urls = $("urls").value.split(/\r?\n/).map(x=>x.trim()).filter(Boolean);
  const files = Array.from($("files").files||[]);
  if(urls.length===0 && files.length===0){
    log("âš ï¸ Ø¶Ø¹ Ø±ÙˆØ§Ø¨Ø· Ø£Ùˆ Ø§Ø®ØªØ± Ù…Ù„ÙØ§Øª Ø£ÙˆÙ„Ø§Ù‹.");
    return;
  }

  try{
    $("go").disabled = true;
    log("â³ ØªØ­Ù…ÙŠÙ„/Ù‚Ø±Ø§Ø¡Ø© Ø§Ù„Ù…ØµØ§Ø¯Ø±...");

    let entries = [];
    let ok=0, fail=0;

    // URLs
    for(const u of urls){
      try{
        const text = await fetchText(u);
        const e = parseM3U(text);
        entries = entries.concat(e);
        ok++;
        log(`âœ… ØªÙ… ØªØ­Ù…ÙŠÙ„: ${u}\nğŸ“º Ù…Ø¬Ù…ÙˆØ¹ Ø§Ù„Ù‚Ù†ÙˆØ§Øª: ${entries.length}`);
      }catch(err){
        fail++;
        log(`âš ï¸ ÙØ´Ù„ ØªØ­Ù…ÙŠÙ„: ${u}\nØ§Ù„Ø³Ø¨Ø¨: ${err.message}`);
      }
    }

    // Files
    for(const f of files){
      const text = await readFileText(f);
      const e = parseM3U(text);
      entries = entries.concat(e);
    }

    if(entries.length===0){
      log("âŒ Ù„Ù… ÙŠØªÙ… Ø§Ø³ØªØ®Ø±Ø§Ø¬ Ø£ÙŠ Ù‚Ù†ÙˆØ§Øª. ØªØ£ÙƒØ¯ Ø£Ù† Ø§Ù„Ø±ÙˆØ§Ø¨Ø· Raw ÙˆØªØ¨Ø¯Ø£ Ø¨Ù€ #EXTM3U.");
      return;
    }

    const before = entries.length;

    if($("dedup").checked){
      const seen = new Set();
      entries = entries.filter(x=>{
        if(seen.has(x.url)) return false;
        seen.add(x.url); return true;
      });
    }

    if($("sort").checked){
      entries.sort((a,b)=>channelName(a.extinf).localeCompare(channelName(b.extinf)));
    }

    let out = "#EXTM3U\n";
    for(const e of entries){
      out += e.extinf + "\n" + e.url + "\n";
    }

    const after = entries.length;
    const removed = before - after;

    log(
      `ğŸ‰ ØªÙ… Ø§Ù„Ø¯Ù…Ø¬!\n`+
      `âœ… Ø±ÙˆØ§Ø¨Ø· Ù†Ø¬Ø­Øª: ${ok} | âš ï¸ ÙØ´Ù„Øª: ${fail}\n`+
      `ğŸ“º Ù‚Ø¨Ù„: ${before} | Ø¨Ø¹Ø¯: ${after}`+
      ($("dedup").checked ? ` | â™»ï¸ Ø­Ø°Ù Ù…ÙƒØ±Ø±: ${removed}` : "")+
      `\nâ¬‡ï¸ Ø³ÙŠØªÙ… ØªÙ†Ø²ÙŠÙ„ Ø§Ù„Ù…Ù„Ù Ø§Ù„Ø¢Ù†...`
    );

    download($("outname").value.trim() || "merged.m3u", out);

  } finally {
    $("go").disabled = false;
  }
};
</script>
</body>
</html>